<% 
  # –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏
  stats = {
    total_users: User.count,
    total_projects: Project.count,
    total_images: Image.count,
    total_folders: Folder.count,
    total_generations: Generation.count,
    total_styles: Style.count,
    total_payments: Payment.count,
    total_token_packages: TokenPackage.count,
    total_token_purchases: TokenPurchase.count,
    active_users: User.where('confirmed_at IS NOT NULL').count,
    recent_users: User.where('created_at > ?', 7.days.ago).count,
    recent_projects: Project.where('created_at > ?', 7.days.ago).count,
    recent_images: Image.where('created_at > ?', 7.days.ago).count,
    total_tokens_spent: TokenTransaction.sum(:amount) || 0,
    total_revenue_cents: Payment.where(status: 'succeeded').sum(:amount_cents) || 0
  }
  
  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
  recent_audit_logs = AuditLog.order(created_at: :desc).limit(5)
%>

<div class="dashboard-container" style="display: flex; gap: 24px; padding: 20px; flex-wrap: wrap;">
  <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —Ç–∞–±–ª–∏—Ü–∞ –º–æ–¥–µ–ª–µ–π -->
  <div class="dashboard-models" style="flex: 0 0 60%; max-width: 60%; min-width: 0;">
    <% if @abstract_models %>
      <div class="table-wrapper">
      <table class="table table-condensed table-striped table-hover">
        <thead>
          <tr>
            <th class="shrink model-name">
              <%= t "admin.table_headers.model_name" %>
            </th>
            <th class="shrink last-created">
              <%= t "admin.table_headers.last_created" %>
            </th>
            <th class="records">
              <%= t "admin.table_headers.records" %>
            </th>
            <th class="shrink controls"></th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          <% @abstract_models.each do |abstract_model| %>
            <% if authorized? :index, abstract_model %>
              <% index_path = index_path(model_name: abstract_model.to_param) %>
              <% row_class = "#{cycle("odd", "even")}#{" link" if index_path} #{abstract_model.param_key}_links" %>
              <tr class="<%= row_class %>" data-link="<%= index_path %>">
                <% last_created = @most_recent_created[abstract_model.model.name] %>
                <% active = last_created.try(:today?) %>
                <td>
                  <span class="show">
                    <%= link_to abstract_model.config.label_plural, index_path %>
                  </span>
                </td>
                <td>
                  <% if last_created %>
                    <%= t "admin.misc.time_ago", time: time_ago_in_words(last_created), default: "#{time_ago_in_words(last_created)} #{t("admin.misc.ago")}" %>
                  <% end %>
                </td>
                <td>
                  <% count = @count[abstract_model.model.name] %>
                  <% percent = count > 0 ? (@max <= 1 ? count : ((Math.log(count+1) * 100.0) / Math.log(@max+1)).to_i) : -1 %>
                  <div class="<%= active ? 'active progress-bar-striped ' : '' %>progress" style="margin-bottom:0px">
                    <div class="bg-<%= get_indicator(percent) %> progress-bar animate-width-to" data-animate-length="<%= ([1.0, percent].max.to_i * 20) %>" data-animate-width-to="<%= [2.0, percent].max.to_i %>%" style="width:2%">
                      <%= @count[abstract_model.model.name] %>
                    </div>
                  </div>
                </td>
                <td class="links">
                  <ul class="nav d-inline list-inline">
                    <%= menu_for :collection, abstract_model, nil, true %>
                  </ul>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
      </div>
    <% end %>
    <% if @history && authorized?(:history_index) %>
      <div class="block" id="block-tables">
        <div class="content">
          <h2>
            <%= t("admin.actions.history_index.menu") %>
          </h2>
          <%= render partial: 'rails_admin/main/dashboard_history' %>
        </div>
      </div>
    <% end %>
    
    <!-- –°–µ–∫—Ü–∏—è —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ -->
    <div class="charts-section" style="margin-top: 30px;">
      <h2 style="color: var(--accent-electric, #00e0ff); margin-bottom: 20px; font-size: 1.5rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">
        üìà –ì—Ä–∞—Ñ–∏–∫–∏ –¥–∏–Ω–∞–º–∏–∫–∏
      </h2>
      
      <!-- –í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ -->
      <div class="period-selector" style="margin-bottom: 20px; display: flex; gap: 10px;">
        <button class="period-btn active" data-period="day" style="padding: 8px 16px; background: var(--panel-raise, #252540); border: 1px solid var(--border-sharp, #2a2a3e); color: var(--text-secondary, #a0a0a0); border-radius: 4px; cursor: pointer; transition: all 0.3s;">
          –î–µ–Ω—å
        </button>
        <button class="period-btn" data-period="week" style="padding: 8px 16px; background: var(--panel-raise, #252540); border: 1px solid var(--border-sharp, #2a2a3e); color: var(--text-secondary, #a0a0a0); border-radius: 4px; cursor: pointer; transition: all 0.3s;">
          –ù–µ–¥–µ–ª—è
        </button>
        <button class="period-btn" data-period="month" style="padding: 8px 16px; background: var(--panel-raise, #252540); border: 1px solid var(--border-sharp, #2a2a3e); color: var(--text-secondary, #a0a0a0); border-radius: 4px; cursor: pointer; transition: all 0.3s;">
          –ú–µ—Å—è—Ü
        </button>
        <button class="period-btn" data-period="year" style="padding: 8px 16px; background: var(--panel-raise, #252540); border: 1px solid var(--border-sharp, #2a2a3e); color: var(--text-secondary, #a0a0a0); border-radius: 4px; cursor: pointer; transition: all 0.3s;">
          –ì–æ–¥
        </button>
      </div>
      
      <!-- –ì—Ä–∞—Ñ–∏–∫–∏ –≤ —Å–µ—Ç–∫–µ -->
      <div class="charts-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
        <!-- –ì—Ä–∞—Ñ–∏–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π -->
        <div class="chart-card" style="background: var(--panel-deep, #1a1a2e); border: 1px solid var(--border-sharp, #2a2a3e); border-radius: 8px; padding: 20px;">
          <h3 style="color: var(--accent-electric, #00e0ff); margin-top: 0; margin-bottom: 15px; font-size: 1.1rem; font-weight: 600;">
            –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
          </h3>
          <div id="user-registrations-chart" data-period="week"></div>
        </div>
        
        <!-- –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
        <div class="chart-card" style="background: var(--panel-deep, #1a1a2e); border: 1px solid var(--border-sharp, #2a2a3e); border-radius: 8px; padding: 20px;">
          <h3 style="color: var(--accent-blue, #667eea); margin-top: 0; margin-bottom: 15px; font-size: 1.1rem; font-weight: 600;">
            –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–≤
          </h3>
          <div id="projects-chart" data-period="week"></div>
        </div>
        
        <!-- –ì—Ä–∞—Ñ–∏–∫ –¥–æ—Ö–æ–¥–æ–≤ -->
        <div class="chart-card" style="background: var(--panel-deep, #1a1a2e); border: 1px solid var(--border-sharp, #2a2a3e); border-radius: 8px; padding: 20px;">
          <h3 style="color: #28a745; margin-top: 0; margin-bottom: 15px; font-size: 1.1rem; font-weight: 600;">
            –î–æ—Ö–æ–¥—ã
          </h3>
          <div id="revenue-chart" data-period="week"></div>
        </div>
        
        <!-- –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
        <div class="chart-card" style="background: var(--panel-deep, #1a1a2e); border: 1px solid var(--border-sharp, #2a2a3e); border-radius: 8px; padding: 20px;">
          <h3 style="color: #ffc107; margin-top: 0; margin-bottom: 15px; font-size: 1.1rem; font-weight: 600;">
            –û–±—â–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
          </h3>
          <div id="activity-chart" data-period="week"></div>
        </div>
      </div>
      
      <!-- –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ -->
      <div class="chart-card" style="background: var(--panel-deep, #1a1a2e); border: 1px solid var(--border-sharp, #2a2a3e); border-radius: 8px; padding: 20px; margin-bottom: 30px;">
        <h3 style="color: var(--accent-electric, #00e0ff); margin-top: 0; margin-bottom: 15px; font-size: 1.1rem; font-weight: 600;">
          –í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
        </h3>
        <div id="conversion-funnel-chart"></div>
      </div>
      
      <!-- –ì—Ä–∞—Ñ–∏–∫–∏ –ø–∞–∫–µ—Ç–æ–≤ —Ç–æ–∫–µ–Ω–æ–≤ –∏ —Å—Ç–∏–ª–µ–π -->
      <div class="charts-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
        <!-- –ì—Ä–∞—Ñ–∏–∫ –ø–∞–∫–µ—Ç–æ–≤ —Ç–æ–∫–µ–Ω–æ–≤ -->
        <div class="chart-card" style="background: var(--panel-deep, #1a1a2e); border: 1px solid var(--border-sharp, #2a2a3e); border-radius: 8px; padding: 20px;">
          <h3 style="color: var(--accent-blue, #667eea); margin-top: 0; margin-bottom: 15px; font-size: 1.1rem; font-weight: 600;">
            –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –ø–∞–∫–µ—Ç–æ–≤ —Ç–æ–∫–µ–Ω–æ–≤
          </h3>
          <div id="token-packages-chart"></div>
        </div>
        
        <!-- –ì—Ä–∞—Ñ–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∏–ª–µ–π -->
        <div class="chart-card" style="background: var(--panel-deep, #1a1a2e); border: 1px solid var(--border-sharp, #2a2a3e); border-radius: 8px; padding: 20px;">
          <h3 style="color: var(--accent-electric, #00e0ff); margin-top: 0; margin-bottom: 15px; font-size: 1.1rem; font-weight: 600;">
            –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —Å—Ç–∏–ª–µ–π
          </h3>
          <div id="styles-chart"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <div class="dashboard-stats" style="flex: 0 0 38%; max-width: 38%;">
    <div class="stats-panel" style="background: var(--panel-deep, #1a1a2e); border: 1px solid var(--border-sharp, #2a2a3e); border-radius: 8px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
      <h2 style="color: var(--accent-electric, #00e0ff); margin-top: 0; margin-bottom: 20px; font-size: 1.5rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">
        üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã
      </h2>

      <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ -->
      <div class="stats-section" style="margin-bottom: 24px;">
        <h3 style="color: var(--accent-blue, #667eea); font-size: 1.1rem; margin-bottom: 12px; font-weight: 600;">
          –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
        </h3>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid var(--accent-electric, #00e0ff);">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</span>
            <strong style="color: var(--accent-electric, #00e0ff); font-size: 1.2rem;"><%= stats[:total_users] %></strong>
          </div>
        </div>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid var(--accent-blue, #667eea);">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</span>
            <strong style="color: var(--accent-blue, #667eea); font-size: 1.2rem;"><%= stats[:active_users] %></strong>
          </div>
        </div>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid #28a745;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–í—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–æ–≤:</span>
            <strong style="color: #28a745; font-size: 1.2rem;"><%= stats[:total_projects] %></strong>
          </div>
        </div>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid #ffc107;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–í—Å–µ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:</span>
            <strong style="color: #ffc107; font-size: 1.2rem;"><%= stats[:total_images] %></strong>
          </div>
        </div>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid #17a2b8;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–í—Å–µ–≥–æ –ø–∞–ø–æ–∫:</span>
            <strong style="color: #17a2b8; font-size: 1.2rem;"><%= stats[:total_folders] %></strong>
          </div>
        </div>
      </div>

      <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –Ω–µ–¥–µ–ª—é -->
      <div class="stats-section" style="margin-bottom: 24px;">
        <h3 style="color: var(--accent-blue, #667eea); font-size: 1.1rem; margin-bottom: 12px; font-weight: 600;">
          –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ 7 –¥–Ω–µ–π
        </h3>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–ù–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</span>
            <strong style="color: var(--accent-electric, #00e0ff);"><%= stats[:recent_users] %></strong>
          </div>
        </div>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–ù–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤:</span>
            <strong style="color: var(--accent-electric, #00e0ff);"><%= stats[:recent_projects] %></strong>
          </div>
        </div>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–ù–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:</span>
            <strong style="color: var(--accent-electric, #00e0ff);"><%= stats[:recent_images] %></strong>
          </div>
        </div>
      </div>

      <!-- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ -->
      <div class="stats-section" style="margin-bottom: 24px;">
        <h3 style="color: var(--accent-blue, #667eea); font-size: 1.1rem; margin-bottom: 12px; font-weight: 600;">
          –§–∏–Ω–∞–Ω—Å—ã –∏ —Ç–æ–∫–µ–Ω—ã
        </h3>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid #28a745;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–û–±—â–∏–π –¥–æ—Ö–æ–¥:</span>
            <strong style="color: #28a745; font-size: 1.2rem;"><%= number_with_delimiter((stats[:total_revenue_cents] / 100.0).round(2), delimiter: ' ') %> ‚ÇΩ</strong>
          </div>
        </div>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid #ffc107;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤:</span>
            <strong style="color: #ffc107; font-size: 1.2rem;"><%= number_with_delimiter(stats[:total_tokens_spent].abs, delimiter: ' ') %></strong>
          </div>
        </div>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–ü–∞–∫–µ—Ç–æ–≤ —Ç–æ–∫–µ–Ω–æ–≤:</span>
            <strong style="color: var(--accent-electric, #00e0ff);"><%= stats[:total_token_packages] %></strong>
          </div>
        </div>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–ü–æ–∫—É–ø–æ–∫ —Ç–æ–∫–µ–Ω–æ–≤:</span>
            <strong style="color: var(--accent-electric, #00e0ff);"><%= stats[:total_token_purchases] %></strong>
          </div>
        </div>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–ì–µ–Ω–µ—Ä–∞—Ü–∏–π:</span>
            <strong style="color: var(--accent-electric, #00e0ff);"><%= stats[:total_generations] %></strong>
          </div>
        </div>
      </div>

      <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div class="stats-section">
        <h3 style="color: var(--accent-blue, #667eea); font-size: 1.1rem; margin-bottom: 12px; font-weight: 600;">
          –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
        </h3>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–°—Ç–∏–ª–µ–π:</span>
            <strong style="color: var(--accent-electric, #00e0ff);"><%= stats[:total_styles] %></strong>
          </div>
        </div>
        <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: var(--text-secondary, #a0a0a0);">–ü–ª–∞—Ç–µ–∂–µ–π:</span>
            <strong style="color: var(--accent-electric, #00e0ff);"><%= stats[:total_payments] %></strong>
          </div>
        </div>
      </div>
      
      <!-- –í–∏–¥–∂–µ—Ç —Ç–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
      <div class="top-users-widget" style="margin-top: 24px;">
        <h3 style="color: var(--accent-blue, #667eea); font-size: 1.1rem; margin-bottom: 12px; font-weight: 600;">
          –¢–æ–ø-10 –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        </h3>
        <div id="top-users-list" style="max-height: 400px; overflow-y: auto;">
          <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ AJAX -->
        </div>
      </div>
      
      <!-- –í–∏–¥–∂–µ—Ç—ã –¥–∞—à–±–æ—Ä–¥–∞ -->
      <%= render partial: 'rails_admin/dashboard/widgets' %>
    </div>
  </div>
</div>

<script>
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –ø–µ—Ä–∏–æ–¥–∞
  document.addEventListener('DOMContentLoaded', function() {
    const periodButtons = document.querySelectorAll('.period-btn');
    periodButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        // –£–±–∏—Ä–∞–µ–º active –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
        periodButtons.forEach(b => b.classList.remove('active'));
        // –î–æ–±–∞–≤–ª—è–µ–º active –∫–ª–∞—Å—Å –∫ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
        this.classList.add('active');
        
        const period = this.dataset.period;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º data-period —É –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
        document.querySelectorAll('[id$="-chart"]').forEach(chart => {
          chart.dataset.period = period;
        });
        
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫–∏
        if (window.railsAdminCharts) {
          // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º —Å—Ç–∞—Ä—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
          Object.keys(window.railsAdminCharts.charts).forEach(key => {
            if (window.railsAdminCharts.charts[key] && window.railsAdminCharts.charts[key].destroy) {
              window.railsAdminCharts.charts[key].destroy();
            }
          });
          window.railsAdminCharts.charts = {};
          
          // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–Ω–æ–≤–æ
          window.railsAdminCharts.init();
        }
      });
    });
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    if (typeof fetch !== 'undefined') {
      fetch('/rails_admin/statistics/top_users?limit=10', {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
          'X-Requested-With': 'XMLHttpRequest'
        },
        credentials: 'same-origin'
      })
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById('top-users-list');
        if (container && data.users) {
          container.innerHTML = data.users.map((user, index) => `
            <div class="stat-card" style="background: var(--panel-raise, #252540); padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 3px solid var(--accent-electric, #00e0ff);">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                <span style="color: var(--text-primary, #ffffff); font-weight: 600;">${index + 1}. ${user.email}</span>
                <a href="/admin/user/${user.id}" style="color: var(--accent-electric, #00e0ff); text-decoration: none;">‚Üí</a>
              </div>
              <div style="display: flex; gap: 12px; font-size: 0.85rem;">
                <span style="color: var(--text-secondary, #a0a0a0);">–ü—Ä–æ–µ–∫—Ç–æ–≤: <strong style="color: var(--accent-blue, #667eea);">${user.projects_count}</strong></span>
                <span style="color: var(--text-secondary, #a0a0a0);">–ì–µ–Ω–µ—Ä–∞—Ü–∏–π: <strong style="color: var(--accent-electric, #00e0ff);">${user.generations_count}</strong></span>
                <span style="color: var(--text-secondary, #a0a0a0);">–¢–æ–∫–µ–Ω–æ–≤: <strong style="color: #ffc107;">${user.tokens_spent}</strong></span>
              </div>
            </div>
          `).join('');
        }
      })
      .catch(error => {
        console.error('Error loading top users:', error);
      });
    }
  });
</script>

<style>
  /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
  @media (max-width: 1200px) {
    .dashboard-container {
      flex-direction: column !important;
    }
    .dashboard-models,
    .dashboard-stats {
      flex: 1 1 100% !important;
      max-width: 100% !important;
    }
    .charts-grid {
      grid-template-columns: 1fr !important;
    }
  }
  
  /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–∏–æ–¥–∞ */
  .period-btn.active {
    background: var(--accent-electric, #00e0ff) !important;
    border-color: var(--accent-electric, #00e0ff) !important;
    color: var(--ink, #03050a) !important;
    font-weight: 600 !important;
  }
  
  .period-btn:hover {
    background: var(--panel-raise, #2a2a4a) !important;
    border-color: var(--accent-electric, #00e0ff) !important;
  }
</style>
