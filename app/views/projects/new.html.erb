<% content_for :title, "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ - VirtualStagingAI" %>

<% content_for :head do %>
    <!-- Space Grotesk ‚Äî –Ω–∞—à —Ñ–∏—Ä–º–µ–Ω–Ω—ã–π -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --pink: #ff3b7f;
            --cyan: #00f7f6;
            --yellow: #ffe600;
            --magenta: #c724b1;
            --bg-deep: #0b0d10;
            --bg-card: #12161c;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg-deep) !important;
            color: #ffffff !important;
        }

        .print-card {
            background: var(--bg-card);
            border: 1px solid #2a2e38;
            box-shadow: 0 20px 35px -10px rgba(0,0,0,0.8);
        }

        .btn-flash {
            background: var(--yellow);
            color: #0b0d10;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-radius: 2px;
            box-shadow: 6px 6px 0 var(--pink);
            transition: 0.1s linear;
            border: none;
            padding: 12px 24px;
        }
        .btn-flash:hover {
            background: #fff150;
            box-shadow: 3px 3px 0 var(--magenta);
            transform: translate(3px, 3px);
        }

        .btn-outlined {
            background: transparent;
            color: var(--cyan);
            border: 2px solid var(--cyan);
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            border-radius: 2px;
            transition: all 0.2s;
            padding: 12px 24px;
        }
        .btn-outlined:hover {
            background: rgba(0, 247, 246, 0.1);
            border-color: #00ffff;
            color: #00ffff;
            box-shadow: 0 0 12px rgba(0, 247, 246, 0.4);
        }

        .input-neon {
            width: 100%;
            padding: 12px 16px;
            background: #1a1d24;
            border: 2px solid #2a2e38;
            color: #ffffff;
            font-family: 'Space Grotesk', sans-serif;
            border-radius: 2px;
            transition: all 0.2s;
        }
        .input-neon:focus {
            outline: none;
            border-color: var(--cyan);
            box-shadow: 0 0 8px rgba(0, 247, 246, 0.3);
        }

        /* Drag and drop –∑–æ–Ω–∞ */
        .drop-zone {
            border: 3px dashed #2a2e38;
            border-radius: 2px;
            transition: all 0.3s;
            background: #1a1d24;
        }
        .drop-zone.dragover {
            border-color: var(--cyan);
            background: rgba(0, 247, 246, 0.1);
            box-shadow: 0 0 20px rgba(0, 247, 246, 0.3);
        }
        .drop-zone.has-file {
            border-color: var(--yellow);
            background: rgba(255, 230, 0, 0.1);
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π file input */
        .file-input-wrapper {
            position: relative;
        }
        .file-input-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 10;
        }

        .neon-pink {
            color: var(--pink);
            text-shadow: 0 0 8px var(--pink), 0 0 20px rgba(255, 59, 127, 0.5);
        }
        .neon-cyan {
            color: var(--cyan);
            text-shadow: 0 0 8px var(--cyan), 0 0 20px rgba(0, 247, 246, 0.4);
        }
    </style>
<% end %>

<div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8" style="background: var(--bg-deep);">
  <div class="max-w-2xl mx-auto">
    <div class="print-card p-8">
      <div class="text-center mb-8">
        <%= link_to dashboard_path, class: "inline-block mb-6" do %>
          <div class="flex items-center justify-center space-x-3">
            <div class="w-10 h-10 bg-[#ffe600] rotate-12 shadow-[4px_4px_0_#ff3b7f]"></div>
            <span class="text-2xl font-black text-white tracking-tight" style="text-shadow: 2px 2px 0 #ff3b7f;">VSAI</span>
          </div>
        <% end %>
        <h1 class="text-3xl font-black uppercase mb-2 neon-pink">–ó–ê–ì–†–£–ó–ò–¢–¨ –§–û–¢–û</h1>
        <p class="text-white/60">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–π–ª–∏–Ω–≥–∞</p>
      </div>

      <%= form_with model: @image, url: projects_path, method: :post, multipart: true, class: "space-y-6", data: { turbo: false }, id: "uploadForm" do |f| %>
        <%= render "shared/error_messages", resource: @image %>

        <!-- Drag and Drop –∑–æ–Ω–∞ -->
        <div class="file-input-wrapper">
          <div class="drop-zone p-12 text-center cursor-pointer relative" id="dropZone">
            <div id="dropZoneContent">
              <div class="text-6xl mb-4">üì∑</div>
              <p class="text-white/80 font-bold text-lg mb-2">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ —Å—é–¥–∞</p>
              <p class="text-white/50 text-sm mb-4">–∏–ª–∏</p>
              <button type="button" class="btn-outlined inline-block" id="selectFileBtn">–í–´–ë–†–ê–¢–¨ –§–ê–ô–õ</button>
              <p class="text-white/40 text-xs mt-4">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: JPG, PNG, WebP</p>
            </div>
            <div id="fileInfo" class="hidden">
              <div class="mb-4">
                <img id="filePreview" src="" alt="Preview" class="max-w-full max-h-64 mx-auto rounded" style="display: none;">
                <div id="fileIcon" class="text-4xl">‚úÖ</div>
              </div>
              <p class="text-white font-bold text-lg mb-2" id="fileName"></p>
              <p class="text-white/60 text-sm mb-4" id="fileSize"></p>
              <div class="flex items-center justify-center gap-4">
                <button type="button" class="text-[#ff3b7f] text-sm font-bold uppercase hover:text-[#ff1a5c] transition-colors" id="removeFile">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
              </div>
            </div>
            <%= f.file_field :file, accept: "image/*", class: "absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10", required: true, id: "fileInput" %>
          </div>
        </div>

        <div>
          <%= f.label :project_id, "–ü–†–û–ï–ö–¢", class: "block text-xs font-bold text-white/60 uppercase tracking-wider mb-2" %>
          <%= f.collection_select :project_id, 
              @projects || current_user.projects.active, 
              :id, 
              :name,
              { prompt: "–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç", selected: @projects&.first&.id },
              { class: "input-neon", id: "project_select" } %>
        </div>
        
        <div>
          <%= f.label :folder_id, "–ö–û–ú–ù–ê–¢–ê / –ü–ê–ü–ö–ê", class: "block text-xs font-bold text-white/60 uppercase tracking-wider mb-2" %>
          <%= f.collection_select :folder_id, 
              (@projects&.first&.folders&.ordered || []),
              :id, 
              :name,
              { prompt: "–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏–ª–∏ –ø–∞–ø–∫—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)", include_blank: true },
              { class: "input-neon", id: "folder_select", required: false } %>
          <p class="text-xs text-white/40 mt-1">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ñ–æ—Ç–æ</p>
          <p class="text-xs text-[#00f7f6] mt-1" id="folder-hint" style="display: none;">
            <span id="folder-count">0</span> –∫–æ–º–Ω–∞—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ
          </p>
        </div>

        <div class="flex space-x-4">
          <%= f.submit "–ó–ê–ì–†–£–ó–ò–¢–¨", class: "btn-flash flex-1 text-sm py-3", id: "submitBtn" %>
          <%= link_to "–û–¢–ú–ï–ù–ê", dashboard_path, class: "btn-outlined flex-1 text-center text-sm py-3" %>
        </div>
      <% end %>
      
      <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
      <div id="uploadProgress" class="hidden mt-4 print-card p-4">
        <div class="flex items-center space-x-3">
          <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-[#00f7f6]"></div>
          <p class="text-white font-bold">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const dropZoneContent = document.getElementById('dropZoneContent');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const removeFileBtn = document.getElementById('removeFile');

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ input
    fileInput.addEventListener('change', function(e) {
      handleFileSelect(e.target.files);
    });

    // –ö–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É "–í–´–ë–†–ê–¢–¨ –§–ê–ô–õ"
    const selectFileBtn = document.getElementById('selectFileBtn');
    if (selectFileBtn) {
      selectFileBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        fileInput.click();
      });
    }

    // –ö–ª–∏–∫ –Ω–∞ drop zone —Ç–∞–∫–∂–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç file picker
    dropZone.addEventListener('click', function(e) {
      // –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º file picker –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É —É–¥–∞–ª–µ–Ω–∏—è
      if (e.target.id === 'removeFile' || e.target.closest('#removeFile')) {
        return;
      }
      // –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –µ—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ (–æ–Ω–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤—ã—à–µ)
      if (e.target.id === 'selectFileBtn' || e.target.closest('#selectFileBtn')) {
        return;
      }
      fileInput.click();
    });

    // Drag and Drop
    dropZone.addEventListener('dragover', function(e) {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', function(e) {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', function(e) {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.remove('dragover');
      
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files;
        handleFileSelect(files);
      }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    function handleFileSelect(files) {
      if (files && files.length > 0) {
        const file = files[0];
        if (file.type.startsWith('image/')) {
          dropZone.classList.add('has-file');
          dropZoneContent.classList.add('hidden');
          fileInfo.classList.remove('hidden');
          
          fileName.textContent = file.name;
          fileSize.textContent = formatFileSize(file.size);
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
          const filePreview = document.getElementById('filePreview');
          const fileIcon = document.getElementById('fileIcon');
          const reader = new FileReader();
          
          reader.onload = function(e) {
            filePreview.src = e.target.result;
            filePreview.style.display = 'block';
            fileIcon.style.display = 'none';
          };
          
          reader.readAsDataURL(file);
          
          // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å - –∞–Ω–∏–º–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
          setTimeout(() => {
            dropZone.style.borderColor = '#ffe600';
            dropZone.style.boxShadow = '0 0 20px rgba(255, 230, 0, 0.5)';
          }, 100);
        } else {
          alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
        }
      }
    }

    // –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–¥–∏–Ω —Ä–∞–∑ –≤ –Ω–∞—á–∞–ª–µ
    const submitBtn = document.getElementById('submitBtn');
    const uploadProgress = document.getElementById('uploadProgress');

    // –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
    if (removeFileBtn) {
      removeFileBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        fileInput.value = '';
        dropZone.classList.remove('has-file');
        dropZoneContent.classList.remove('hidden');
        fileInfo.classList.add('hidden');
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
        const filePreview = document.getElementById('filePreview');
        const fileIcon = document.getElementById('fileIcon');
        if (filePreview) {
          filePreview.src = '';
          filePreview.style.display = 'none';
        }
        if (fileIcon) {
          fileIcon.style.display = 'block';
        }
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏
        dropZone.style.borderColor = '';
        dropZone.style.boxShadow = '';
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = '–ó–ê–ì–†–£–ó–ò–¢–¨';
        }
        if (uploadProgress) {
          uploadProgress.classList.add('hidden');
        }
      });
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }

    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–ø–æ–∫ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞
    const projectSelect = document.getElementById('project_select');
    const folderSelect = document.getElementById('folder_select');
    
    if (projectSelect && folderSelect) {
      // –î–∞–Ω–Ω—ã–µ –æ –ø–∞–ø–∫–∞—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
      const foldersData = {};
      <% (@projects || current_user.projects.active.includes(:folders)).each do |project| %>
      foldersData['<%= project.id %>'] = [
        <% project.folders.ordered.each do |folder| %>
        { id: <%= folder.id %>, name: <%= folder.name.to_json.html_safe %> },
        <% end %>
      ];
      <% end %>
      
      console.log('Folders data loaded:', foldersData);

      projectSelect.addEventListener('change', function() {
        const projectId = this.value;
        console.log('Project changed to:', projectId);
        const folders = foldersData[projectId] || [];
        console.log('Folders for project:', folders);
        
        // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫ –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
        folderSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É –∏–ª–∏ –ø–∞–ø–∫—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</option>';
        folderSelect.value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
        const folderHint = document.getElementById('folder-hint');
        const folderCount = document.getElementById('folder-count');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞–ø–∫–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
        if (folders.length > 0) {
          folders.forEach(function(folder) {
            const option = document.createElement('option');
            option.value = folder.id.toString(); // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
            option.textContent = folder.name;
            folderSelect.appendChild(option);
          });
          console.log('Added', folders.length, 'folders to select');
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∫–æ–º–Ω–∞—Ç
          if (folderHint && folderCount) {
            folderCount.textContent = folders.length;
            folderHint.style.display = 'block';
          }
          
          // –î–µ–ª–∞–µ–º select –≤–∏–¥–∏–º—ã–º –∏ –∞–∫—Ç–∏–≤–Ω—ã–º
          folderSelect.style.display = 'block';
          folderSelect.disabled = false;
        } else {
          console.warn('No folders found for project', projectId);
          if (folderHint) {
            folderHint.style.display = 'none';
          }
          folderSelect.disabled = false; // –†–∞–∑—Ä–µ—à–∞–µ–º –≤—ã–±–æ—Ä –¥–∞–∂–µ –µ—Å–ª–∏ –ø–∞–ø–æ–∫ –Ω–µ—Ç
        }
      });
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
      const uploadFormValidation = document.getElementById('uploadForm');
      
      if (uploadFormValidation) {
        uploadFormValidation.addEventListener('submit', function(e) {
          const projectId = projectSelect.value;
          const folderId = folderSelect.value;
          console.log('Form submit - Project ID:', projectId, 'Folder ID:', folderId);
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª –≤—ã–±—Ä–∞–Ω
          if (!fileInput.files || fileInput.files.length === 0) {
            e.preventDefault();
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏');
            return false;
          }
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –ø–∞–ø–∫–∞, —Ç–æ –≤—ã–±—Ä–∞–Ω –∏ –ø—Ä–æ–µ–∫—Ç
          if (folderId && !projectId) {
            e.preventDefault();
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç');
            return false;
          }
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–∞–ø–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É
          if (folderId && projectId) {
            const folders = foldersData[projectId] || [];
            const folderExists = folders.some(function(f) { 
              return String(f.id) === String(folderId); 
            });
            if (!folderExists) {
              // –ï—Å–ª–∏ –ø–∞–ø–∫–∞ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø—Ä–æ–µ–∫—Ç—É, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –µ—ë
              console.warn('Folder', folderId, 'does not belong to project', projectId);
              console.warn('Available folders:', folders.map(f => f.id + ':' + f.name));
              folderSelect.value = '';
              // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É - –ø—Ä–æ—Å—Ç–æ —É–±–∏—Ä–∞–µ–º folder_id
              // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–æ–µ–∫—Ç –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –ø–∞–ø–∫–∏
            }
          }
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
          if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.textContent = '–ó–ê–ì–†–£–ó–ö–ê...';
          }
          if (uploadProgress) {
            uploadProgress.classList.remove('hidden');
          }
        });
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      if (projectSelect.value) {
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏, —á—Ç–æ DOM –≥–æ—Ç–æ–≤
        setTimeout(function() {
          projectSelect.dispatchEvent(new Event('change'));
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É, –µ—Å–ª–∏ –ø–∞–ø–∫–∏ –µ—Å—Ç—å
          const folders = foldersData[projectSelect.value] || [];
          const folderHint = document.getElementById('folder-hint');
          const folderCount = document.getElementById('folder-count');
          if (folders.length > 0 && folderHint && folderCount) {
            folderCount.textContent = folders.length;
            folderHint.style.display = 'block';
          }
        }, 100);
      }
    }
  }); // –ó–∞–∫—Ä—ã–≤–∞–µ–º document.addEventListener('DOMContentLoaded', function() {

</script>
