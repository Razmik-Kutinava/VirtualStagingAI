<% content_for :title, "Dashboard - VirtualStagingAI" %>

<% content_for :head do %>
    <!-- Inter ‚Äî —à—Ä–∏—Ñ—Ç –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º—ã D3 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ---------- –î–ò–ó–ê–ô–ù-–°–ò–°–¢–ï–ú–ê VSAI D3 ---------- */
        :root {
            /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–æ–Ω—ã */
            --ink: #03050a;
            --panel-deep: #0b0e14;
            --panel-raise: #12161e;
            
            /* –ì—Ä–∞–Ω–∏—Ü—ã –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ */
            --border-sharp: #1e2632;
            
            /* –ê–∫—Ü–µ–Ω—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
            --accent-electric: #00e0ff;
            --accent-blue: #2f6cff;
            
            /* –¢–µ–∫—Å—Ç */
            --text-primary: #ffffff;
            --text-secondary: #a0b3d9;
            --text-muted: #62748c;
            
            /* –°–≤–µ—á–µ–Ω–∏–µ */
            --glow-electric: rgba(0, 224, 255, 0.35);
            --glow-blue: rgba(47, 108, 255, 0.25);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--ink);
            color: var(--text-primary);
            letter-spacing: -0.01em;
            position: relative;
        }

        /* –¢–µ—Ö–Ω–æ-—Å–µ—Ç–∫–∞ (–ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ) */
        body::before {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background-image: 
                linear-gradient(var(--border-sharp) 1px, transparent 1px),
                linear-gradient(90deg, var(--border-sharp) 1px, transparent 1px);
            background-size: 48px 48px;
            opacity: 0.2;
            pointer-events: none;
            z-index: 9998;
        }

        /* –°–∫–∞–Ω–∏—Ä—É—é—â–∞—è –ª–∏–Ω–∏—è (–º–∏–∫—Ä–æ-–∞–Ω–∏–º–∞—Ü–∏—è) */
        body::after {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, 
                rgba(0,224,255,0) 0px, 
                rgba(0,224,255,0.02) 2px, 
                transparent 4px
            );
            pointer-events: none;
            z-index: 9999;
            opacity: 0.3;
        }

        /* –ù–µ–æ–Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç */
        .neon-electric {
            color: var(--accent-electric);
            text-shadow: 0 0 12px var(--accent-electric), 0 0 30px rgba(0,224,255,0.4);
        }

        /* –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .print-card {
            background: var(--panel-raise);
            border: 1px solid var(--border-sharp);
            box-shadow: 0 20px 35px -15px rgba(0,0,0,0.8);
            transition: border 0.2s, box-shadow 0.3s, transform 0.15s;
        }
        .print-card:hover {
            border: 1px solid var(--accent-electric);
            box-shadow: 0 25px 40px -20px var(--glow-electric);
            transform: translateY(-2px);
        }

        /* –ö–Ω–æ–ø–∫–∞ –æ—Å–Ω–æ–≤–Ω–∞—è (solid) */
        .btn-flash {
            background: var(--accent-blue);
            color: var(--text-primary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 0;
            box-shadow: 0 6px 0 #001a4f;
            transition: 0.1s linear;
            border: none;
        }
        .btn-flash:hover {
            transform: translateY(2px);
            box-shadow: 0 4px 0 #001a4f;
        }

        .btn-cyan {
            background: var(--accent-blue);
            color: var(--text-primary);
            box-shadow: 0 6px 0 #001a4f;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            border-radius: 0;
        }
        .btn-cyan:hover {
            transform: translateY(2px);
            box-shadow: 0 4px 0 #001a4f;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω—Ç—É—Ä–Ω–∞—è */
        .btn-outlined {
            background: transparent;
            color: var(--accent-electric);
            border: 2px solid var(--accent-electric);
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            border-radius: 0;
            transition: all 0.2s;
        }
        .btn-outlined:hover {
            background: var(--accent-electric);
            color: var(--ink);
            box-shadow: 0 0 25px var(--glow-electric);
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar {
            width: 5px;
        }
        ::-webkit-scrollbar-track {
            background: var(--panel-deep);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--accent-blue);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-electric);
        }

        /* –ë–æ–∫–æ–≤–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
        .dash-nav-item {
            border-left: 3px solid transparent;
            transition: 0.15s;
        }
        .dash-nav-item:hover, .dash-nav-item.active {
            border-left: 3px solid var(--accent-electric);
            background: rgba(0, 224, 255, 0.05);
        }

        /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å */
        .divider-d3 {
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--accent-electric), transparent);
            opacity: 0.3;
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
        .progress-track {
            background: #1a212c;
            height: 6px;
        }
        .progress-fill {
            background: var(--accent-electric);
            height: 6px;
            box-shadow: 0 0 12px var(--accent-electric);
        }

        /* –ë–µ–π–¥–∂–∏ */
        .badge-d3 {
            background: rgba(0,224,255,0.08);
            border: 1px solid rgba(0,224,255,0.3);
            color: var(--accent-electric);
            font-size: 0.65rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            border-radius: 0;
        }

        /* –°—Ç–∞—Ç—É—Å-–±–µ–π–¥–∂–∏ */
        .badge-processing {
            background: rgba(0, 224, 255, 0.08);
            border: 1px solid rgba(0, 224, 255, 0.3);
            color: var(--accent-electric);
        }
        .badge-done {
            background: rgba(47, 108, 255, 0.08);
            border: 1px solid rgba(47, 108, 255, 0.3);
            color: var(--accent-blue);
        }

        /* –ü–∞–≥–∏–Ω–∞—Ü–∏—è */
        .pagination-d3 {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border-sharp);
            color: var(--text-secondary);
            transition: 0.1s;
            border-radius: 0;
        }
        .pagination-d3:hover, .pagination-d3.active {
            border-color: var(--accent-electric);
            color: var(--accent-electric);
            background: rgba(0,224,255,0.05);
        }
    </style>
<% end %>

<div class="flex h-screen overflow-hidden">
    
    <!-- ========== –õ–ï–í–ê–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø ========== -->
    <aside class="w-80 flex-shrink-0 print-card border-r flex flex-col" style="background: var(--panel-deep); border-right: 1px solid var(--border-sharp);">
        <!-- –ª–æ–≥–æ—Ç–∏–ø -->
        <div class="flex items-center space-x-3 px-5 py-6 border-b" style="border-color: var(--border-sharp);">
            <%= link_to root_path, class: "flex items-center space-x-3" do %>
                <div class="w-8 h-8 bg-[var(--accent-electric)] rotate-12" style="box-shadow: 4px 4px 0 var(--accent-blue);"></div>
                <span class="text-2xl font-semibold text-white tracking-tight neon-electric">VSAI</span>
            <% end %>
        </div>
        
            <!-- –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—É–Ω–∫—Ç—ã -->
            <nav class="flex-1 px-3 py-6 space-y-1 overflow-y-auto">
                <%= link_to dashboard_path(folder: "all"), 
                    class: "dash-nav-item flex items-center px-3 py-2.5 font-medium #{'active' if @folder == 'all'}",
                    style: "color: var(--text-primary);" do %>
                    <span class="text-lg mr-2 flex-shrink-0" style="color: var(--accent-electric);">‚¨ú</span>
                    <span class="flex-1">–í—Å–µ —Ñ–æ—Ç–æ</span>
                    <span class="text-xs badge-d3 flex-shrink-0" style="min-width: 28px; text-align: center; margin-left: auto;"><%= @total_photos %></span>
                <% end %>
                
                <%= link_to dashboard_path(folder: "unfiled"), 
                    class: "dash-nav-item flex items-center px-3 py-2.5 #{'active' if @folder == 'unfiled'}",
                    style: "color: var(--text-secondary);" do %>
                    <span class="text-lg mr-2 flex-shrink-0" style="color: var(--accent-electric);">üñºÔ∏è</span>
                    <span class="flex-1">–ë–µ–∑ –ø–∞–ø–∫–∏</span>
                    <span class="text-xs badge-d3 flex-shrink-0" style="min-width: 28px; text-align: center; margin-left: auto;"><%= @unfiled_count %></span>
                <% end %>
                
                <%= link_to dashboard_path(folder: "trash"), 
                    class: "dash-nav-item flex items-center px-3 py-2.5 #{'active' if @folder == 'trash'}",
                    style: "color: var(--text-secondary);" do %>
                    <span class="text-lg mr-2 flex-shrink-0" style="color: var(--accent-electric);">üóëÔ∏è</span>
                    <span class="flex-1">–ö–æ—Ä–∑–∏–Ω–∞</span>
                    <span class="text-xs badge-d3 flex-shrink-0" style="min-width: 28px; text-align: center; margin-left: auto;"><%= @trash_count %></span>
                <% end %>
            
            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–æ–º–Ω–∞—Ç -->
            <div class="pt-6 mt-6 border-t" style="border-color: var(--border-sharp);">
                <div class="px-4 py-2 text-xs font-semibold uppercase tracking-wider mb-2" style="color: var(--text-muted); letter-spacing: 1px;">–ö–û–ú–ù–ê–¢–´</div>
                <div class="space-y-1">
                    <% @room_categories.each do |category| %>
                        <%= link_to dashboard_path(folder: category[:slug]), 
                            class: "dash-nav-item flex items-center px-3 py-2.5 #{'active' if @folder == category[:slug]}",
                            style: "color: var(--text-secondary);",
                            data: { turbo_frame: "photos-grid" } do %>
                            <span class="text-lg mr-2 flex-shrink-0"><%= category[:icon] %></span>
                            <span class="font-medium flex-1 text-sm"><%= category[:name] %></span>
                            <span class="text-xs badge-d3 flex-shrink-0" style="min-width: 28px; text-align: center; margin-left: auto;"><%= category[:count] %></span>
                        <% end %>
                    <% end %>
                </div>
            </div>
            
            <!-- –ü—Ä–æ–µ–∫—Ç—ã -->
            <div class="pt-6 mt-6 border-t" style="border-color: var(--border-sharp);">
                <div class="px-4 py-2 text-xs font-semibold uppercase tracking-wider mb-2 flex items-center justify-between" style="color: var(--text-muted); letter-spacing: 1px;">
                    <span>–ü–†–û–ï–ö–¢–´</span>
                    <button onclick="openProjectModal()" class="text-[var(--accent-electric)] hover:text-[var(--accent-blue)] transition-colors cursor-pointer" title="–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç">
                        <span class="text-lg">+</span>
                    </button>
                </div>
                <% if @projects.any? %>
                    <div class="space-y-1">
                        <% @projects.each do |project| %>
                            <% project_images_count = current_user.images.input.not_deleted.where(project_id: project.id).count %>
                                <div class="group relative">
                                    <div class="dash-nav-item flex items-center px-3 py-2.5 cursor-pointer" 
                                         style="color: var(--text-secondary);"
                                         onclick="toggleProjectFolders(this.closest('.group'))">
                                        <span class="text-lg mr-2 flex-shrink-0" style="color: var(--accent-blue);">üìÅ</span>
                                        <span class="font-medium flex-1 truncate text-sm"><%= project.name %></span>
                                        <span class="text-xs badge-d3 flex-shrink-0" style="min-width: 28px; text-align: center; margin-left: auto;"><%= project_images_count %></span>
                                        <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ -->
                                        <%= button_to project_path(project),
                                            method: :delete,
                                            class: "opacity-0 group-hover:opacity-100 transition-opacity p-1.5 hover:bg-[var(--panel-deep)] rounded flex-shrink-0 ml-2",
                                            style: "color: var(--text-muted);",
                                            title: "–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç",
                                            data: { project_name: project.name },
                                            onclick: "event.stopPropagation(); return confirmDeleteProject(event, this.dataset.projectName);" do %>
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="color: var(--accent-electric);">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        <% end %>
                                    </div>
                                <div class="hidden pl-4 space-y-1" id="project-<%= project.id %>-folders">
                                    <% project.folders.ordered.each do |folder| %>
                                        <% folder_count = current_user.images.input.not_deleted.where(folder_id: folder.id).count %>
                                        <%= link_to dashboard_path(folder: folder.id.to_s), 
                                            class: "dash-nav-item flex items-center px-3 py-2 #{'active' if @folder == folder.id.to_s}",
                                            style: "color: var(--text-muted); font-size: 0.875rem;",
                                            data: { turbo_frame: "photos-grid" } do %>
                                            <span class="text-base mr-2 flex-shrink-0"><%= folder.icon || "üìÑ" %></span>
                                            <span class="font-medium flex-1 truncate text-sm"><%= folder.name %></span>
                                            <span class="text-xs badge-d3 flex-shrink-0" style="min-width: 28px; text-align: center; margin-left: auto;"><%= folder_count %></span>
                                        <% end %>
                                    <% end %>
                                </div>
                            </div>
                        <% end %>
                    </div>
                <% else %>
                    <div class="px-4 py-3 text-sm" style="color: var(--text-muted);">
                        <p>–ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É "+" –≤—ã—à–µ.</p>
                    </div>
                <% end %>
            </div>
            
            <!-- –í—Å–µ –ø–∞–ø–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ) -->
            <% if @folders.any? && false %>
                <div class="pt-6 mt-6 border-t" style="border-color: var(--border-sharp);">
                    <div class="px-4 py-2 text-xs font-semibold uppercase tracking-wider mb-2" style="color: var(--text-muted); letter-spacing: 1px;">–ü–ê–ü–ö–ò</div>
                    <div class="space-y-1">
                        <% @folders.each do |folder| %>
                            <%= link_to dashboard_path(folder: folder[:slug]), 
                                class: "dash-nav-item flex items-center space-x-4 px-4 py-3 #{'active' if @folder == folder[:slug]}",
                                style: "color: var(--text-secondary);",
                                data: { turbo_frame: "photos-grid" } do %>
                                <span class="text-xl"><%= folder[:icon] %></span>
                                <span class="font-medium"><%= folder[:name] %></span>
                                <span class="ml-auto text-xs badge-d3"><%= folder[:count] %></span>
                            <% end %>
                        <% end %>
                    </div>
                </div>
            <% end %>
        </nav>
        
        <!-- –±–∞–ª–∞–Ω—Å / –∞–ø–≥—Ä–µ–π–¥ -->
        <div class="p-5 border-t" style="border-color: var(--border-sharp);">
            <div class="print-card p-4" style="background: var(--panel-deep);">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs uppercase tracking-wider" style="color: var(--text-muted); letter-spacing: 1px;">–ë–∞–ª–∞–Ω—Å</span>
                    <span class="neon-electric font-semibold"><%= @token_balance %></span>
                </div>
                <div class="w-full progress-track mb-4">
                    <% balance_percent = [(@token_balance.to_f / 1000 * 100).round, 100].min %>
                    <div class="progress-fill" style="width: <%= balance_percent %>%;"></div>
                </div>
                <%= link_to "#", class: "btn-flash text-xs py-2 px-3 w-full text-center block" do %>
                    –ü–æ–ø–æ–ª–Ω–∏—Ç—å
                <% end %>
            </div>
        </div>
    </aside>

    <!-- ========== –ü–†–ê–í–ê–Ø –ß–ê–°–¢–¨ ========== -->
    <div class="flex-1 flex flex-col overflow-hidden">
        
        <!-- ========== –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ ========== -->
        <header class="print-card flex-shrink-0 flex justify-between items-center px-8 py-4 border-b" style="background: var(--panel-raise); border-bottom: 1px solid var(--border-sharp);">
            <h2 class="text-2xl font-semibold uppercase tracking-tight">
                <span class="neon-electric">
                    <%= case @folder
                        when "all" then "–í–°–ï –§–û–¢–û"
                        when "unfiled" then "–ë–ï–ó –ü–ê–ü–ö–ò"
                        when "trash" then "–ö–û–†–ó–ò–ù–ê"
                        when "living_room", "bedroom", "dining_room", "kitchen", "bathroom", "office", "main_area"
                          @room_categories.find { |c| c[:slug] == @folder }&.dig(:name)&.upcase || "–ö–û–ú–ù–ê–¢–ê"
                        else
                          # –ò—â–µ–º –ø–∞–ø–∫—É –ø–æ ID
                          folder_id = @folder.to_i
                          if folder_id > 0
                            folder = Folder.joins(:project).where(id: folder_id, projects: { user_id: current_user.id }).first
                            folder ? "#{folder.project.name} / #{folder.name}".upcase : "–ü–ê–ü–ö–ê"
                          else
                            "–ü–†–û–ï–ö–¢–´"
                          end
                        end %>
                </span>
                <span class="mx-2" style="color: var(--text-muted);">/</span>
                <span style="color: var(--text-primary);">
                    <%= @images.count %> –∏–∑ <%= case @folder
                        when "all" then @total_photos
                        when "unfiled" then @unfiled_count
                        when "trash" then @trash_count
                        when "living_room", "bedroom", "dining_room", "kitchen", "bathroom", "office", "main_area"
                          @room_categories.find { |c| c[:slug] == @folder }&.dig(:count) || 0
                        else
                          folder_id = @folder.to_i
                          if folder_id > 0
                            folder = Folder.joins(:project).where(id: folder_id, projects: { user_id: current_user.id }).first
                            folder ? current_user.images.input.not_deleted.where(folder_id: folder.id).count : 0
                          else
                            0
                          end
                        end %>
                </span>
            </h2>
            <div class="flex items-center space-x-6">
                <!-- –ö–Ω–æ–ø–∫–∞ Add Photo (outlined style) -->
                <%= link_to new_project_path, class: "btn-outlined text-xs py-2.5 px-5 whitespace-nowrap" do %>
                    + –î–û–ë–ê–í–ò–¢–¨ –§–û–¢–û
                <% end %>
                
                <!-- —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—ã—Å—Ç—Ä–∞—è -->
                <div class="flex items-center space-x-3 text-sm">
                    <span style="color: var(--text-muted);">–ö–†–ï–î–ò–¢–û–í:</span>
                    <span class="font-semibold" style="color: var(--accent-electric);"><%= @token_balance %></span>
                    <span style="color: var(--border-sharp);">|</span>
                    <span style="color: var(--text-muted);">–û–ë–†–ê–ë–û–¢–ê–ù–û:</span>
                    <span class="font-semibold" style="color: var(--accent-blue);"><%= @total_photos %></span>
                </div>
                <!-- –ø—Ä–æ—Ñ–∏–ª—å -->
                <div class="relative" data-controller="dropdown">
                    <button class="flex items-center space-x-3 print-card px-4 py-2 transition-all" data-action="click->dropdown#toggle" data-dropdown-target="button" style="background: var(--panel-deep); border: 1px solid var(--border-sharp);">
                        <span class="text-sm font-semibold uppercase" style="color: var(--text-secondary);"><%= current_user.email.split('@').first %></span>
                        <div class="w-9 h-9 bg-[var(--accent-electric)] rotate-6" style="box-shadow: 3px 3px 0 var(--accent-blue);"></div>
                        <svg class="w-4 h-4" style="color: var(--text-muted);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div class="hidden absolute right-0 mt-2 w-48 print-card py-1 z-50 border-2" data-dropdown-target="menu" style="background: var(--panel-raise); border-color: var(--accent-electric); opacity: 0.5;">
                        <%= link_to edit_user_registration_path, class: "block px-4 py-3 text-sm hover:bg-[var(--panel-deep)] transition-colors font-medium uppercase tracking-wide", style: "color: var(--text-secondary);" do %>
                            ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                        <% end %>
                        <%= link_to destroy_user_session_path, method: :delete, data: { turbo_method: :delete }, class: "block px-4 py-3 text-sm hover:bg-[var(--panel-deep)] transition-colors font-semibold uppercase tracking-wide border-t", style: "color: var(--accent-electric); border-color: var(--border-sharp);" do %>
                            üö™ –í—ã—Ö–æ–¥
                        <% end %>
                    </div>
                </div>
            </div>
        </header>

        <!-- ========== –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ ========== -->
        <main class="flex-1 overflow-y-auto px-8 py-8" style="background: var(--ink);">
            
            <%= turbo_frame_tag "photos-grid" do %>
                <% if @images.any? %>
                    <!-- —Å–µ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                        <% @images.each do |image| %>
                            <%= render "dashboard/photo_card", image: image %>
                        <% end %>
                    </div>

                    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                    <% if @total_pages > 1 %>
                        <div class="flex justify-center items-center space-x-2 mt-12">
                            <% if @page > 1 %>
                                <%= link_to "‚Üê", dashboard_path(folder: @folder, page: @page - 1), 
                                    class: "pagination-d3 text-sm font-semibold",
                                    data: { turbo_frame: "photos-grid" } %>
                            <% end %>
                            
                            <% start_page = [@page - 2, 1].max %>
                            <% end_page = [start_page + 4, @total_pages].min %>
                            <% (start_page..end_page).each do |page_num| %>
                                <% if page_num == @page %>
                                    <span class="pagination-d3 active text-sm font-semibold"><%= page_num %></span>
                                <% else %>
                                    <%= link_to page_num, dashboard_path(folder: @folder, page: page_num), 
                                        class: "pagination-d3 text-sm font-semibold",
                                        data: { turbo_frame: "photos-grid" } %>
                                <% end %>
                            <% end %>

                            <% if @page < @total_pages %>
                                <%= link_to "‚Üí", dashboard_path(folder: @folder, page: @page + 1), 
                                    class: "pagination-d3 text-sm font-semibold",
                                    data: { turbo_frame: "photos-grid" } %>
                            <% end %>
                        </div>
                    <% end %>
                <% else %>
                    <!-- Empty State -->
                    <div class="print-card p-20 text-center border-2 border-dashed" style="border-color: var(--accent-electric); opacity: 0.3;">
                        <div class="text-7xl mb-6 neon-electric">üì∑</div>
                        <h2 class="text-2xl font-semibold mb-2 neon-electric">Nothing here yet</h2>
                        <p class="mb-8 max-w-md mx-auto" style="color: var(--text-secondary);">–ù–∞—á–Ω–∏—Ç–µ —Å –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–≤–æ–≥–æ —Ñ–æ—Ç–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞–π–ª–∏–Ω–≥–∞</p>
                        <%= link_to "–î–û–ë–ê–í–ò–¢–¨ –§–û–¢–û", new_project_path, class: "btn-flash inline-block px-8 py-4 text-sm" %>
                    </div>
                <% end %>
            <% end %>
        </main>
    </div>
</div>

    <!-- —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ -->
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
        function openProjectModal() {
            fetch('<%= new_project_projects_path %>', {
                method: 'GET',
                headers: {
                    'Accept': 'text/html',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.text())
            .then(html => {
                // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å
                const existingModal = document.getElementById('new-project-modal');
                if (existingModal) {
                    existingModal.remove();
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤ body
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = html;
                document.body.appendChild(modalContainer);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                const modal = document.getElementById('new-project-modal');
                if (modal) {
                    modal.style.opacity = '0';
                    modal.style.transition = 'opacity 0.2s ease-in';
                    setTimeout(() => {
                        modal.style.opacity = '1';
                    }, 10);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞:', error);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function openImageModal(imageId) {
            const imagePath = '/images/' + imageId + '/modal';
            fetch(imagePath, {
                method: 'GET',
                headers: {
                    'Accept': 'text/html',
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                }
                return response.text();
            })
            .then(html => {
                // –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –µ—Å–ª–∏ –µ—Å—Ç—å
                const existingModal = document.getElementById('image-modal-' + imageId);
                if (existingModal) {
                    existingModal.remove();
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤ body
                const modalContainer = document.createElement('div');
                modalContainer.innerHTML = html;
                document.body.appendChild(modalContainer);
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
                const modal = document.getElementById('image-modal-' + imageId);
                if (modal) {
                    modal.style.opacity = '0';
                    modal.style.transition = 'opacity 0.2s ease-in';
                    setTimeout(() => {
                        modal.style.opacity = '1';
                    }, 10);
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏');
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function closeImageModal(imageId) {
            const modal = document.getElementById('image-modal-' + imageId);
            if (modal) {
                modal.style.opacity = '0';
                modal.style.transition = 'opacity 0.2s ease-out';
                setTimeout(() => {
                    modal.remove();
                }, 200);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeProjectModal() {
            const modal = document.getElementById('new-project-modal');
            if (modal) {
                modal.style.opacity = '0';
                setTimeout(() => {
                    modal.remove();
                }, 200);
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeProjectModal();
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞
        function confirmDeleteProject(event, projectName) {
            const confirmed = confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç "${projectName}"?\n\n–í—Å–µ –ø–∞–ø–∫–∏ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.\n\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`);
            if (!confirmed) {
                event.preventDefault();
                event.stopPropagation();
                return false;
            }
            return true;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –ø–∞–ø–æ–∫ –ø—Ä–æ–µ–∫—Ç–∞
        function toggleProjectFolders(groupElement) {
            // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω —ç–ª–µ–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —è–≤–ª—è–µ—Ç—Å—è group, –Ω–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–∏–π group
            const group = groupElement.classList && groupElement.classList.contains('group') 
                ? groupElement 
                : groupElement.closest('.group');
            if (!group) return;
            
            // –ù–∞—Ö–æ–¥–∏–º div —Å –ø–∞–ø–∫–∞–º–∏
            const foldersDiv = group.querySelector('[id^="project-"][id$="-folders"]');
            if (!foldersDiv) return;
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–∞–ø–æ–∫
            if (foldersDiv.classList.contains('hidden')) {
                foldersDiv.classList.remove('hidden');
            } else {
                foldersDiv.classList.add('hidden');
            }
        }
        
        // –ê–∫—Ç–∏–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Rails
        document.querySelectorAll('.dash-nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                // –£–±–∏—Ä–∞–µ–º active —Å–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                document.querySelectorAll('.dash-nav-item').forEach(nav => nav.classList.remove('active'));
                // –î–æ–±–∞–≤–ª—è–µ–º active –∫ —Ç–µ–∫—É—â–µ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
                if (!this.classList.contains('active')) {
                    this.classList.add('active');
                }
            });
        });

        // Dropdown –º–µ–Ω—é –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è
        document.addEventListener('DOMContentLoaded', function() {
            const dropdownButtons = document.querySelectorAll('[data-dropdown-target="button"]');
            const dropdownMenus = document.querySelectorAll('[data-dropdown-target="menu"]');
            
            dropdownButtons.forEach((button, index) => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const menu = dropdownMenus[index];
                    const isHidden = menu.classList.contains('hidden');
                    
                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–µ–Ω—é
                    dropdownMenus.forEach(m => m.classList.add('hidden'));
                    
                    // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ, –µ—Å–ª–∏ –±—ã–ª–æ —Å–∫—Ä—ã—Ç–æ
                    if (isHidden) {
                        menu.classList.remove('hidden');
                    }
                });
            });
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            document.addEventListener('click', function(e) {
                if (!e.target.closest('[data-controller="dropdown"]')) {
                    dropdownMenus.forEach(menu => menu.classList.add('hidden'));
                }
            });
        });
    </script>
